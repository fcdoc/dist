<!doctypehtml><meta charset=UTF-8><link rel="alternate" type="application/rss+xml" hreflang="zh" href="/zh.rss"><link rel=stylesheet href=//registry.npmmirror.com/18x/latest/files/_.css><script src=//registry.npmmirror.com/18x/latest/files/seo.js></script><link rel=alternate href="https://doc.flashduty.com/flashduty/mixin/single_sign_on/keycloak" hreflang=x-default><link rel=stylesheet href=//registry.npmmirror.com/18x/latest/files/seo.css><link rel=alternate hreflang=en href="https://doc.flashduty.com/en/flashduty/mixin/single_sign_on/keycloak.htm"><link rel=alternate hreflang=zh href="https://doc.flashduty.com/zh/flashduty/mixin/single_sign_on/keycloak.htm"><title>Keycloak配置单点登录、配置SSO登录</title><main><article><hr /><h2>brief: 在Keycloak中配置单点登录教程</h2><h1>Keycloak配置单点登录、配置SSO登录</h1><h2>快速了解</h2><p>Keycloak 是一个开源的身份和访问管理解决方案，它提供了一套全面的工具和功能，帮助开发人员快速实现安全的用户身份验证和授权机制，同时简化了应用程序的身份和访问管理流程</p><blockquote><p>[!NOTE]
本篇文章不涉及部署和讲解 Keycloak 相关内容，如需了解更多信息，请参考<a href="https://www.keycloak.org/">官方文档</a></p></blockquote><h2>基于 SAML2.0 协议</h2><h3>1.登录 FlashDuty 控制台</h3><h4>1.1 从 FlashDuty 获取 acs 地址（第2步会用到）</h4><h4>1.2 路径：访问控制=&gt;单点登录=&gt;设置=&gt;SAML2.0协议=&gt;Flashcat服务提供商信息=&gt;Assertion Consumer Service URL</h4><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/1.avif" alt="" /></p><h3>2.登录Keycloak控制台新建一个 Client</h3><h4>2.1 路径：Clients =&gt; Create client</h4><h4>2.2 Client Type：选择 SAML 协议</h4><h4>2.3 Client ID填写： flashcat.cloud（固定值，不可更改）</h4><h4>2.4 Valid redirect URIs： 填写从 FlashDuty 获取的 acs 地址</h4><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/2.avif" alt="" /><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/3.avif" alt="" /></p><h3>3.配置Client相关信息</h3><h4>3.1 Name ID format 更改为email类型</h4><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/4.avif" alt="" /></p><h4>3.2 Client signature required 设置为关闭状态</h4><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/5.avif" alt="" /></p><h4>3.3 创建 email/phone/username 三种字段类型</h4><blockquote><p>[!NOTE]
创建之前需要先删除之前 OpenID Connect 协议的用户，创建完成设置为 Default
<img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/6.avif" alt="" /><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/7.avif" alt="" /></p></blockquote><h4>3.4 将添加的用户加入到 Client 中</h4><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/8.avif" alt="" /><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/9.avif" alt="" /></p><h4>3.5 配置 email/phone/username 映射器(以 email 为例，其他按照下面步骤配置即可)</h4><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/10.avif" alt="" /><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/11.avif" alt="" /><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/12.avif" alt="" /></p><h3>4.下载 XML 文件</h3><blockquote><p>[!NOTE]
下载的文件是一个压缩包，在本地解压后会有两个xml文件，只需要 idp-metadata.xml 文件即可</p></blockquote><h4>4.1 在 Client&gt;Action 中下载到本地</h4><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/13.avif" alt="" /></p><h4>4.2 上传 XML 文件到 FlashDuty 的单点登录配置中</h4><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/14.avif" alt="" /></p><h3>5.在 Keycloak 创建用户并测试登录</h3><h4>5.1 创建用户（一定要绑定一个邮箱地址）</h4><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/15.avif" alt="" /></p><h4>5.2 登录测试</h4><ul><li>访问console.flashcat.cloud，选择SSO登录---域名处填写单点登录配置中登录域名前缀</li></ul><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/16.avif" alt="" /></p><h2>基于 OIDC 协议</h2><h3>1.登录 FlashDuty 平台</h3><ul><li>从FlashDuty获取Redirect URL（第2步会用到）</li><li>路径：<strong>访问控制=&gt;单点登录=&gt;设置=&gt;OIDC协议=&gt;Flashcat 服务提供商信息==&gt;Redirect URL</strong><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/17.avif" alt="" /></li></ul><h3>2.登录 Keycloak 控制台新建一个 Client</h3><ul><li>Client Type：选择 OIDC 协议</li><li>Clinet ID：没有特殊要求</li><li>Client authentication：保持开启状态</li><li>Valid redirect URIs：填写第1步获取的 Redirect URL 地址</li></ul><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/18.avif" alt="" /><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/19.avif" alt="" /><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/20.avif" alt="" /></p><h3>3.获取 Client 的相关信息</h3><ul><li>Client ID：创建 Client 时填写的ID</li><li>Client Secret：<strong>Client 详情=&gt;Credentials</strong> 卡片中即可看到</li><li>Issuer：<strong>Realm settings=&gt;Endpoints=&gt;OpenID Endpoint Configuration</strong></li></ul><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/21.avif" alt="" /><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/22.avif" alt="" /></p><h3>4.FlashDuty 单点登录配置样式</h3><p><img src="https://fcimg.3ti.site/zh/flashduty/mixin/single_sign_on/keycloak/23.avif" alt="" /></p><blockquote><p>[!NOTE]
基于OIDC配置完成后，登录测试参考 配置单点登录 部分即可</p></blockquote></article><nav><a href="/">doc.flashduty.com</a><a href="/zh/flashduty">FlashDuty : 一站式告警响应平台</a></nav><footer><div id="Ft"><b><a class="site" href="//flashcat.cloud"></a><b>© 快猫星云</b><b>文档由<a class="a" href="https://i18n.site">i18n.site</a>构建</b></b><b><a href="//github.com/flashcatcloud">&#xe64c;</a></b></div></footer></main>